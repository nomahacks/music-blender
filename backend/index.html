<html>
<head>
    <title>Music Blender</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/1.0.10/purify.min.js"></script>
    <script>
        // remap console.log to be just p()
        const p = (...args) => {
            console.log(...args)
        }
        const pp = (...args) => {
            console.log(JSON.stringify(...args))
        }
        let id = ""
        let hostname = window.location.href;
        $(document).ready(() => {

            $("#search").click(() => {

                let artist_names = {"artist1": DOMPurify.sanitize($("#artist1").val())/*, "artist2": $("#artist2").val()*/}
                // $.post(
                //     "http://localhost:3000/api/v1/artist_id",
                //     artist_names,
                //      (data)=>{
                //         if (data === 'done') {
                //             alert("Blend success");
                //         }
                //     }
                // ).done( (data)=>{
                //     alert("Data Loaded: " + JSON.stringify(data))
                //     $(".result").append(`<ul>${JSON.stringify(data)}</ul>`)
                // });
                //
                $.get(`${hostname}api/v1/artist_id/`, artist_names, (data) => {
                    if (data === 'done') {
                        alert("Blend success")
                    }
                }).done((data) => {
                    alert("Responce:" + JSON.stringify(data))
                    id = data
                    p(id)
                })
            })
            $("#blend").click(() => {
                $(".result").empty()
                let artist_names = {"artist1": DOMPurify.sanitize($("#artist1").val())}

                $.get(`${hostname}api/v1/artist_id/`, artist_names, (data) => {
                    if (data === 'done') {
                        alert("Blend success")
                    }
                }).done((data) => {

                        let artist_name = {"id": data}
                        $.get(`${hostname}api/v1/related_artist/`, artist_name, (data) => {
                            if (data === 'done') {
                                alert("Blend success")
                            }
                        }).done((artists) => {
                            //v2
                            try {
                                let html_output = ""
                                let artist_names = artists.map((artist) => {
                                    html_output += `<li><a href="${artist.url}"> <img  src="${artist.img}" alt="${artist.name}" width="${artist.width}" height="auto"> ${artist.name}</a> </li>`
                                    return artist.name
                                })
                                $(".result").append(`<ol>${html_output}</ol>`)
                            } catch (e) {
                                alert(`Artist not found: ${$("#artist1").val()}`)
                            }
                        })
                })
            })
        });
    </script>
</head>
<body>
<h1>Music Blender</h1>
<input type="TEXT" id="artist1" value="daft punk" size="40"><br>
<!--<input type="TEXT" id="artist2" value="daft punk" size="40"><br>-->

<!--<input type="button" id="search" value="Search">-->
<input type="button" id="blend" value="Blend">
<!--<form action="/api/v1/artist_id" method="post">-->
<!--    <input type="text" id="artist1" name="artist1" value="muse" placeholder="muse">-->
<!--    <input type="text" id="artist2" name="artist2" value="daft punk" placeholder="daft punk"><br><br>-->
<!--    <input type="submit" value="Blend">-->
<!--</form>-->
<div class="result"></div>
</body>
</html>